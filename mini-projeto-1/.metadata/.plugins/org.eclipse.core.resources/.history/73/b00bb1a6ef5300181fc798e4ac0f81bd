package br.edu.ifpb.tsi.pd;

import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.File;
import java.io.IOException;
import java.net.Socket;
import java.nio.file.Files;

public class ServidorThread extends Thread{
	final private String baseDirectory = System.getProperty("user.dir").concat("/public/");
	private Socket socket;
	private String file_name, status;

	public ServidorThread(Socket socket) {
		this.socket = socket;
	}
	
	public String pathApplication() {
		return "";	
	}
	
	public void run() {
		try {
			//System.out.println("Thread atual no servidor: " + Thread.currentThread().getName());
			System.out.println("Conectou com " + socket.getInetAddress() + ":" + socket.getPort());
			DataInputStream in = new DataInputStream(socket.getInputStream());
			DataOutputStream out = new DataOutputStream(socket.getOutputStream());
			
			//recuperando nome do arquivo
			file_name = in.readUTF();
			System.out.println("Servidor recebeu: " + file_name);
			
			//buscando o arquivo
			File file = new File(baseDirectory + file_name);
		
			if(file.exists()) {
				System.out.println("arquivo encontrado");
				status = "200";
				out.writeUTF(status);
				String conteudo = new String(Files.readAllBytes(arquivo.toPath()));
				//System.out.println(conteudo);
				out.writeUTF("Conteúdo do arquivo: " + file + "\n" + conteudo + "\n");
				
			}else {
				System.out.println("não achou");
				status = "400";
				out.writeUTF(status);
			}
			
			socket.close();
		}catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}
}
