package br.edu.ifpb.tsi.pd;

import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.File;
import java.io.IOException;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.Scanner;

public class ServidorWeb {

	public static void main(String[] args) {
		String file, status;
		ServerSocket ss;
		
		
		try {
			ss = new ServerSocket(4101);
			Socket socket = ss.accept();
			System.out.println("Conectou com " + socket.getInetAddress() + ":" + socket.getPort());
			DataInputStream in = new DataInputStream(socket.getInputStream());
			DataOutputStream out = new DataOutputStream(socket.getOutputStream());
			
			//lógica
			//recuperando nome do arquivo
			file = in.readUTF();
			System.out.println("Servidor recebeu: " + file);
			
			//buscando o arquivo
			File arquivo = new File("C:\\Users\\jaeni\\Documents\\TSI - IFPB\\2018.1\\Programação Distribuída"
					+ "\\workspace\\Mini Projetos\\Mini Projeto 1\\Servidor\\public\\" + file);
			
			if(arquivo.exists()) {
				System.out.println("achou");
				status = "200";
				Scanner scanner = new Scanner(arquivo);
				String conteudo = "";
				while(scanner.hasNext()) {
					System.out.println("entrou no while");
					conteudo += scanner.nextLine();
					out.writeUTF("Conteúdo do arquivo: " + file + "\n" + conteudo);
				}
				out.writeUTF("Conteúdo do arquivo:" + conteudo);
				
			}else {
				System.out.println("não achou");
				status = "400";
			}
			
			out.writeUTF(status);
			
			socket.close();
			ss.close();
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}

}
